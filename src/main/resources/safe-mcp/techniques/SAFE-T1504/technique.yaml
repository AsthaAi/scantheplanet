id: SAFE-T1504
name: 'SAFE-T1504: Token Theft via API Response'
severity: high
summary: |-
  Token theft via API response when secrets or auth tokens from upstream APIs are
  returned to the user or LLM.
description: |-
  Tactic: Credential Access (ATK-TA0006). Technique: SAFE-T1504. Severity: high.
  Detection guidance:
  - Require that upstream API responses containing access tokens, API keys, or secrets
    are forwarded to user-visible output or tool responses.
  - Identify the code path that returns the sensitive field (for example, access_token).
  Exclusions:
  - Do not flag generic API JSON responses that do not include secrets.
mitigations: []
code_signals:
- id: SAFE-T1504-signal-1
  description: Potential indicators for this technique in code or configuration.
  heuristics:
  - pattern: '*safe*'
  - pattern: '*t1504*'
  - pattern: '*theft*'
  - pattern: '*response*'
languages: []
output_schema:
  requires_mitigations: false
  allowed_status_values:
  - pass
  - fail
  - unknown
llm_required: true
