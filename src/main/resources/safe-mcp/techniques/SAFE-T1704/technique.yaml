id: SAFE-T1704
name: Compromised-Server Pivot / SSRF
severity: P0
summary: 'User-controlled URLs in server requests enable SSRF and access to internal resources'
description: 'Compromised-Server Pivot / SSRF occurs when MCP tools accept user-controlled URLs
  in HTTP requests without host allowlisting or validation. Attackers exploit this to access
  internal services, cloud metadata endpoints, localhost services, or private network resources
  that the MCP server can reach but the attacker cannot directly access.'
mitigations:
- SAFE-M-3
- SAFE-M-6
code_signals:
- id: SAFE-T1704.signal.user_controlled_url
  description: Detects user-controlled URLs in fetch/request operations
  heuristics:
  - regex: 'fetch\s*\(\s*(?:req\.|request\.|params\.|input\.|url)'
    flags: i
  - regex: 'axios\.\w+\s*\(\s*(?:req\.|request\.|params\.|input\.)'
    flags: i
  - regex: 'requests\.(?:get|post|put|delete)\s*\(\s*(?:req|request|params|input|url)'
    flags: i
  - regex: 'http\.(?:get|request)\s*\(\s*(?:req|request|params|input)'
    flags: i
  - regex: 'urllib\.request\.urlopen\s*\(\s*(?:req|request|params|input)'
    flags: i
- id: SAFE-T1704.signal.internal_access
  description: Detects access to internal/metadata endpoints
  heuristics:
  - pattern: '169.254.169.254'
  - pattern: 'metadata.google.internal'
  - regex: '(?:localhost|127\.0\.0\.1|0\.0\.0\.0|::1):\d+'
  - regex: '(?:10\.\d+|172\.(?:1[6-9]|2\d|3[01])|192\.168)\.\d+\.\d+'
  - pattern: 'metadata/computeMetadata'
  - pattern: '/latest/meta-data'
- id: SAFE-T1704.signal.missing_allowlist
  description: Detects missing URL/host allowlisting
  heuristics:
  - regex: 'url_validation.*(?:false|disable|skip|none)'
    flags: i
  - regex: 'allowlist.*(?:false|disable|\[\]|empty|none)'
    flags: i
  - regex: 'host_check.*(?:false|disable|skip)'
    flags: i
  - pattern: 'allow_any_host'
  - pattern: 'skip_url_validation'
languages:
- typescript
- javascript
- python
- go
output_schema:
  requires_mitigations: false
  allowed_status_values:
  - pass
  - fail
  - partial
  - unknown
