id: SAFE-T1503
name: Environment Variable Scraping
severity: P1
summary: 'MCP tools enumerate or dump environment variables to extract secrets'
description: 'Environment Variable Scraping extracts secrets from process environment variables.
  MCP server tools iterate over process.env, os.environ, or use getenv with attacker-controlled
  keys to harvest API keys, database passwords, cloud credentials, and other sensitive configuration
  stored in environment variables.'
mitigations:
- SAFE-M-3
- SAFE-M-6
code_signals:
- id: SAFE-T1503.signal.env_dump
  description: Detects bulk environment variable enumeration
  heuristics:
  - pattern: 'Object.keys(process.env)'
  - pattern: 'Object.entries(process.env)'
  - pattern: 'JSON.stringify(process.env)'
  - pattern: 'os.environ.items()'
  - pattern: 'os.environ.keys()'
  - pattern: 'dict(os.environ)'
  - regex: 'for\s.*\s+in\s+(?:process\.env|os\.environ)'
    flags: i
  - pattern: 'printenv'
  - pattern: 'env | grep'
- id: SAFE-T1503.signal.targeted_env_access
  description: Detects targeted access to sensitive environment variables
  heuristics:
  - regex: '(?:process\.env|os\.environ|os\.getenv|env::var)\s*[\[.(]\s*[''"](?:.*(?:SECRET|PASSWORD|TOKEN|API_KEY|PRIVATE_KEY|DATABASE_URL|DB_PASS))'
    flags: i
  - regex: 'getenv\s*\(\s*[''"](?:.*(?:SECRET|PASSWORD|TOKEN|KEY|CREDENTIAL))'
    flags: i
  - regex: 'env\s*\[\s*[''"](?:AWS_|AZURE_|GCP_|GITHUB_|NPM_|DOCKER_).*(?:KEY|TOKEN|SECRET|PASS)'
    flags: i
- id: SAFE-T1503.signal.env_exfiltration
  description: Detects environment variables being sent externally
  heuristics:
  - regex: '(?:fetch|axios|request|http).*(?:process\.env|os\.environ)'
    flags: i
  - regex: 'JSON\.stringify\s*\(\s*process\.env\s*\)'
  - regex: '(?:log|print|console|write).*(?:process\.env|os\.environ)'
    flags: i
languages:
- typescript
- javascript
- python
- go
- rust
output_schema:
  requires_mitigations: false
  allowed_status_values:
  - pass
  - fail
  - partial
  - unknown
