id: SAFE-T1605
name: Capability Mapping
severity: P1
summary: 'Systematic enumeration of server capabilities, API versions, and permission boundaries'
description: 'Capability Mapping systematically discovers MCP server capabilities, supported API
  versions, feature flags, and permission boundaries. Attackers use introspection endpoints,
  capability negotiation, and API probing to build a comprehensive map of what the target
  system can do, identifying the most valuable attack vectors.'
mitigations:
- SAFE-M-6
code_signals:
- id: SAFE-T1605.signal.capability_enumeration
  description: Detects capability and feature enumeration patterns
  heuristics:
  - regex: '(?:list|get|fetch|enumerate).*(?:capabilities|features|permissions)'
    flags: i
  - regex: 'capabilities\.(?:list|get|query|check)\s*\('
    flags: i
  - pattern: 'server/capabilities'
  - pattern: 'getServerCapabilities'
  - pattern: 'listCapabilities'
- id: SAFE-T1605.signal.api_introspection
  description: Detects API version and endpoint introspection
  heuristics:
  - regex: '(?:api|server)/(?:version|info|health|status|meta)'
  - regex: '(?:introspect|discover|probe).*(?:api|endpoint|version)'
    flags: i
  - regex: 'swagger|openapi|graphql.*introspection'
    flags: i
  - pattern: '__schema'
  - pattern: '_introspection'
- id: SAFE-T1605.signal.permission_probing
  description: Detects systematic permission boundary testing
  heuristics:
  - regex: 'for\s.*(?:permission|capability|feature).*(?:test|check|probe)'
    flags: i
  - regex: 'try.*catch.*(?:permission|forbidden|unauthorized)'
    flags: i
  - regex: '(?:brute|fuzz|enumerate).*(?:permission|scope|role)'
    flags: i
languages:
- typescript
- javascript
- python
output_schema:
  requires_mitigations: false
  allowed_status_values:
  - pass
  - fail
  - partial
  - unknown
