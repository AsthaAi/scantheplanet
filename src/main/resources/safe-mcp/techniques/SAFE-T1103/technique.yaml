id: SAFE-T1103
name: Fake Tool Invocation
severity: P0
summary: 'Function name spoofing or tool impersonation to execute unauthorized operations'
description: 'Fake Tool Invocation exploits insufficient tool validation in MCP hosts by injecting
  or spoofing tool names, duplicating tool registrations, or manipulating the JSON-RPC tool call
  protocol. Attackers can redirect legitimate tool calls to malicious implementations or register
  tools that shadow trusted ones.'
mitigations:
- SAFE-M-1
- SAFE-M-6
code_signals:
- id: SAFE-T1103.signal.tool_name_spoofing
  description: Detects tool name manipulation or collision patterns
  heuristics:
  - regex: 'tool_name\s*[:=]\s*(?:req\.|request\.|params\.|input\.)'
    flags: i
  - regex: 'registerTool\s*\(\s*[^)]*(?:override|replace|shadow)'
    flags: i
  - regex: 'tools\.(?:set|register|add)\s*\([^)]*(?:existing|override)'
    flags: i
  - pattern: 'tool_override'
  - pattern: 'shadow_tool'
  - pattern: 'replace_tool'
- id: SAFE-T1103.signal.jsonrpc_manipulation
  description: Detects JSON-RPC tool call protocol manipulation
  heuristics:
  - regex: 'method\s*[:=]\s*[''"]tools/call[''"]'
  - regex: 'JSON\.parse\s*\(.*method'
    flags: i
  - pattern: 'tools/call'
  - regex: 'jsonrpc.*method.*(?:override|inject|spoof)'
    flags: i
- id: SAFE-T1103.signal.duplicate_registration
  description: Detects duplicate tool registration that could enable shadowing
  heuristics:
  - regex: 'addTool\s*\(.*(?:name|id)\s*[:=]'
    flags: i
  - regex: 'server\.tool\s*\(\s*[''"]'
  - pattern: 'tool_registry'
  - regex: 'tools\[.*\]\s*=\s*(?:function|async|\()'
languages:
- typescript
- javascript
- python
output_schema:
  requires_mitigations: false
  allowed_status_values:
  - pass
  - fail
  - partial
  - unknown
