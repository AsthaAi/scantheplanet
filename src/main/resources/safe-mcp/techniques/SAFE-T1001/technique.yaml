id: SAFE-T1001
name: Tool Poisoning Attack (TPA)
severity: P1
summary: 'Hidden instructions in tool descriptions manipulate LLM behavior'
description: 'Tool Poisoning Attack (TPA) embeds malicious instructions within MCP tool descriptions that are invisible
  to users but processed by LLMs. This exploits the difference between displayed and processed tool descriptions.'
mitigations:
- SAFE-M-1
- SAFE-M-6
code_signals:
- id: SAFE-T1001.signal.hidden_html
  description: Detects HTML comment injection used to hide directives
  heuristics:
  # Substring matches - no wildcards needed
  - pattern: '<!-- SYSTEM'
  - pattern: '<!--SYSTEM'
  - pattern: '<!-- INSTRUCTION'
  - pattern: '<!--INSTRUCTION'
  - pattern: '<!-- OVERRIDE'
- id: SAFE-T1001.signal.llm_tokens
  description: Detects LLM-specific tokens that could hijack context
  heuristics:
  - pattern: '<|system|>'
  - pattern: '<|im_start|>'
  - pattern: '<|im_end|>'
  - pattern: '<|user|>'
  - pattern: '<|assistant|>'
  - pattern: '[INST]'
  - pattern: '[/INST]'
  - pattern: '### Instruction:'
  - pattern: '### Response:'
  - pattern: '<s>'
  - pattern: '</s>'
- id: SAFE-T1001.signal.unicode_obfuscation
  description: Detects Unicode obfuscation in source code (escaped forms)
  heuristics:
  # Escaped Unicode in source code strings
  - pattern: '\u200b'
  - pattern: '\u200c'
  - pattern: '\u200d'
  - pattern: '\u202a'
  - pattern: '\u202b'
  - pattern: '\u202c'
  - pattern: '\u202d'
  - pattern: '\u202e'
  - pattern: '\ufeff'
  # Hex escapes
  - pattern: '\x00'
  - pattern: '\x0b'
languages:
- typescript
- javascript
- python
output_schema:
  requires_mitigations: false
  allowed_status_values:
  - pass
  - fail
  - partial
  - unknown
