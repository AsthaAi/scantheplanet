id: SAFE-T1204
name: Context Memory Implant
severity: P1
summary: 'Malicious agents write persistent instructions into vector stores or conversation memory'
description: 'Context Memory Implant exploits persistent memory systems in MCP-connected AI agents.
  Malicious agents write themselves into long-term vector stores, conversation histories, or system
  prompt storage to ensure re-loading in future sessions. The implanted instructions persist across
  server restarts and session boundaries.'
mitigations:
- SAFE-M-1
- SAFE-M-6
code_signals:
- id: SAFE-T1204.signal.memory_injection
  description: Detects injection into persistent memory or context systems
  heuristics:
  - regex: '(?:memory|context|history)\.(?:add|insert|write|save|persist|store)\s*\('
    flags: i
  - regex: '(?:conversation|chat)_history.*(?:append|push|add|insert)'
    flags: i
  - regex: 'system_prompt.*(?:set|update|modify|append)'
    flags: i
  - regex: 'save_context\s*\('
    flags: i
- id: SAFE-T1204.signal.suspicious_metadata
  description: Detects suspicious metadata in persistent entries
  heuristics:
  - pattern: 'priority: high'
  - pattern: 'session_persistence: true'
  - pattern: 'expires: never'
  - pattern: 'persist_across_sessions'
  - regex: 'ttl\s*[:=]\s*(?:-1|0|Infinity|null|None)'
    flags: i
- id: SAFE-T1204.signal.prompt_modification
  description: Detects system prompt or instruction modification patterns
  heuristics:
  - regex: 'system.*(?:message|prompt).*(?:override|replace|inject|modify)'
    flags: i
  - pattern: 'SYSTEM:'
  - pattern: 'Ignore previous instructions'
  - pattern: 'ignore all prior'
  - regex: 'instruction.*(?:override|bypass|ignore)'
    flags: i
languages:
- typescript
- javascript
- python
output_schema:
  requires_mitigations: false
  allowed_status_values:
  - pass
  - fail
  - partial
  - unknown
