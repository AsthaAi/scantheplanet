id: SAFE-T1201
name: MCP Rug Pull Attack
severity: P1
summary: 'Tools with dynamic definitions can change behavior after user approval'
description: 'MCP Rug Pull Attack is a persistence technique where tools appear legitimate initially but can change
  their behavior after gaining user trust. This exploits dynamic tool definitions, remote configuration loading,
  or time-delayed activation to modify tool behavior post-approval.

  Static analysis detects code patterns that ENABLE rug pulls: dynamic descriptions, remote tool loading without
  version pinning, and time-based conditional behavior.'
mitigations:
- SAFE-M-2
code_signals:
- id: SAFE-T1201.signal.dynamic_description
  description: Detects tool descriptions computed at runtime
  heuristics:
  # Description from variable/function
  - pattern: 'setDescription('
  - pattern: 'updateDescription('
  - regex: 'description\s*[:=]\s*\w+\('
    flags: i
  - regex: 'description\s*[:=]\s*await'
    flags: i
  - regex: 'description\s*[:=]\s*.*\$\{'
    flags: i
- id: SAFE-T1201.signal.remote_tool_load
  description: Detects tool definitions loaded from remote sources
  heuristics:
  - pattern: 'loadToolsFrom'
  - pattern: 'fetchToolDefinitions'
  - pattern: 'fetchTools('
  - pattern: 'getRemoteTools'
  - pattern: 'tool_manifest_url'
  - pattern: 'toolManifestUrl'
  - pattern: 'tools_endpoint'
  - regex: 'tools\s*=\s*await\s*fetch'
    flags: i
  - regex: 'tools\s*=\s*axios'
    flags: i
- id: SAFE-T1201.signal.time_delayed
  description: Detects time-based conditional behavior
  heuristics:
  # Time checks that could enable delayed activation
  - regex: 'if\s*\([^)]*(Date\.now\(|time\.time\(|datetime\.now\(|System\.currentTimeMillis\(|Instant\.now\())'
  - regex: 'setTimeout\s*\([^)]*(enable|activate|unlock|tool)'
    flags: i
  - regex: 'setInterval\s*\([^)]*(enable|activate|unlock|tool)'
    flags: i
- id: SAFE-T1201.signal.config_mutation
  description: Detects tool configuration that can be mutated
  heuristics:
  - regex: 'tool\.config\s*='
  - regex: 'toolConfig\s*='
    flags: i
  - pattern: 'updateTool('
  - pattern: 'modifyTool('
  - pattern: 'patchTool('
  - pattern: 'refreshTools('
  - pattern: 'reloadTools('
languages:
- typescript
- javascript
- python
output_schema:
  requires_mitigations: false
  allowed_status_values:
  - pass
  - fail
  - partial
  - unknown
