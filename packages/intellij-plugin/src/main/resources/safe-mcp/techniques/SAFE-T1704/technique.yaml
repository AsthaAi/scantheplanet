id: SAFE-T1704
name: 'SAFE‑T1704: Compromised‑Server Pivot'
severity: high
summary: |-
  Server-side request forgery/pivot risk when untrusted input controls outbound
  network fetches without host allowlisting or internal-IP restrictions.
description: |-
  Tactic: Lateral Movement (ATK‑TA0008). Technique: SAFE‑T1704. Severity: high.
  Detection guidance:
  - Require untrusted input controlling a URL/host that the server fetches.
  - Require missing safeguards: no domain allowlist, no scheme restriction, and no
    IP-range filtering (private/loopback/link-local/metadata ranges).
  - Require explicit evidence of internal/metadata address usage or reachability
    (IP literals, localhost, 169.254.169.254, RFC1918 ranges, or no DNS/IP
    normalization while user input controls the host).
  Exclusions:
  - Do not flag if the URL host is derived from a strict allowlist or fixed base.
  - Do not flag if internal/metadata IP ranges are blocked or normalized away.
  - Do not flag if internal address reachability is only hypothetical.
mitigations: []
code_signals:
- id: SAFE-T1704-signal-1
  description: Potential indicators for this technique in code or configuration.
  heuristics:
  - pattern: '*safe*'
  - pattern: '*t1704*'
  - pattern: '*compromised*'
  - pattern: '*pivot*'
languages: []
output_schema:
  requires_mitigations: false
  allowed_status_values:
  - pass
  - fail
  - unknown
llm_required: true
